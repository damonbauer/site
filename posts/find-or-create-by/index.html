<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="description" content="Find or Create By (Rails)" />
    <title>Find or Create By (Rails)</title>
    <style type="text/css">body{max-width:600px;font-size:20px}</style>
  </head>
  <body>
    <header>
      <a href="/">damon bauer's blog</a><br>
      <span>developer, amateur woodworker</span>
    </header><br><br>

    <small>2019-12-27</small>
    <h1 style="margin-top:0">
      Find or Create By (Rails)
    </h1>
    <p>Recently on a Rails project, I had the need to create a <code>shelf</code> record and associate it with a <code>book</code> record. (These particular records are using a <code>has_many :through</code> relationship).</p>
<p>The problem I ran into was the need to search for a <code>book</code> to associate with; if it didn't exist, I needed to create it first... I found that Rails has me covered.</p>
<p><a href="https://apidock.com/rails/v6.0.0/ActiveRecord/Relation/find_or_create_by"><code>find_or_create_by</code></a> will either find a record with the provided attributes, or create it. (shocker)</p>
<p>Here's how I used it:</p>
<pre><code class="language-ruby/1,2,11,18">def add
  shelf = find_or_create_shelf
  book = find_or_create_book
  SavedBook.create(book_id: book.id, shelf_id: shelf.id)

  redirect_to user_to_read_path(params[:user_id]), notice: '✓ Book saved for later.'
end

private

def find_or_create_book
    Book.find_or_create_by(id: params[:book_id],
                           image: params.dig(:book, :image),
                           title: params.dig(:book, :title),
                           author: params.dig(:book, :author))
  end

  def find_or_create_shelf
    Shelf.find_or_create_by(user_id: params[:user_id])
  end
</code></pre>

    <a href="/">← Back</a>
  </body>
</html>
